

# Task 17.2 ‚Äî Parallel Split Validation & Legacy Control Node UI Cleanup

**Status:** NEW  
**Category:** Super DAG ‚Äì Execution Layer (Safety & UX)  
**Depends on:**  
- Task 15.x (Work Center & Behavior system defaults)  
- Task 16 (Execution Mode Binding & NodeType Model)  
- Task 17 (Parallel Node Execution & Merge Semantics)

---

# üéØ Objective

1. **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏µ‡πà‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏∏‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠** ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° validation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ:
   - Node ‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å (outgoing edges) ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡πÄ‡∏™‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Parallel ‡∏´‡∏£‡∏∑‡∏≠ Decision/Conditional
   - Node ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Merge ‡πÅ‡∏ï‡πà topology ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ parallel_group ‡πÉ‡∏´‡πâ merge ‡∏à‡∏£‡∏¥‡∏á)

2. **‡∏ó‡∏≥‡πÉ‡∏´‡πâ UX ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏ö‡∏™‡∏ô** ‡πÇ‡∏î‡∏¢:
   - ‡∏ã‡πà‡∏≠‡∏ô / ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Node ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏Å‡πà‡∏≤: `split`, `join`, `wait`
   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á Node ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏ö‡∏ö Legacy ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö SuperDAG model ‡πÉ‡∏´‡∏°‡πà

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ñ‡∏∑‡∏≠ SuperDAG ‡∏à‡∏∞:
- ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô (graph ‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
- ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô Node Split/Join/Wait ‡πÉ‡∏´‡πâ‡∏™‡∏±‡∏ö‡∏™‡∏ô)
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ model ‡πÉ‡∏´‡∏°‡πà: `is_parallel_split`, `is_merge_node`, `merge_mode` + conditional edges

---

# üß© Scope

## In Scope

- Frontend: `graph_designer.js`
- Backend API: `dag_routing_api.php` (‡∏´‡∏£‡∏∑‡∏≠ endpoint ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ save / validate graph)
- Documentation: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏ô Task 17 section ‡∏ß‡πà‡∏≤‡∏°‡∏µ validation layer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Parallel/Decision ‡πÅ‡∏•‡πâ‡∏ß

## Out of Scope

- ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå legacy ‡∏à‡∏≤‡∏Å DB (`join_type`, `join_quorum`, `split_policy`, etc.)
- ‡∏Å‡∏≤‡∏£‡∏•‡∏ö logic legacy ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô service ‡∏ä‡∏±‡πâ‡∏ô‡∏•‡∏∂‡∏Å (‡πÉ‡∏ä‡πâ Task ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)

---

# üì¶ Deliverables

## 1. Frontend ‚Äì Graph Designer Validation & UI Cleanup

‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å:

- `assets/javascripts/dag/graph_designer.js`

### 1.1 ‡∏ã‡πà‡∏≠‡∏ô / ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Node Type ‡πÅ‡∏ö‡∏ö Legacy

**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ user ‡∏™‡∏£‡πâ‡∏≤‡∏á Node ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:
- `split`
- `join`
- `wait`

‡πÇ‡∏î‡∏¢:

- ‡∏•‡∏ö / ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π / toolbar ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á node type ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)  
- ‡∏´‡∏≤‡∏Å‡∏°‡∏µ dialog / context menu ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á node type ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏™‡∏µ‡∏à‡∏≤‡∏Å `NODE_COLORS` ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤) ‡πÅ‡∏ï‡πà‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á node ‡πÉ‡∏´‡∏°‡πà

### 1.2 Validation: Multi Outgoing Edge ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Intent (Parallel ‡∏´‡∏£‡∏∑‡∏≠ Decision)

‡∏Å‡πà‡∏≠‡∏ô save ‡∏Å‡∏£‡∏≤‡∏ü (‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° nodes/edges ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡πÑ‡∏õ API) ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° validation:

1. ‡∏ß‡∏ô node ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÉ‡∏ô cytoscape graph
2. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ node:
   - ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô outgoing edges: `outgoingEdgesCount`
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö flag:
     - `isParallelSplit` (‡∏à‡∏≤‡∏Å node.data)
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó edge:
     - ‡∏´‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö edge type ‡πÄ‡∏ä‡πà‡∏ô `edge_type = 'conditional'` ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á edge data ‡∏°‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

3. Logic ‡πÇ‡∏î‡∏¢‡∏™‡∏£‡∏∏‡∏õ:

```pseudo
if outgoingEdgesCount > 1 then
    if isParallelSplit == false AND ‡πÑ‡∏°‡πà‡∏°‡∏µ edge ‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô conditional/decision ‡∏à‡∏£‡∏¥‡∏á‡πÜ then
        ‡πÅ‡∏™‡∏î‡∏á Warning/Modal:
            "Node ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Parallel ‡∏´‡∏£‡∏∑‡∏≠ Decision/Conditional"
        ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á:
            [A] Mark as Parallel Split  (‡∏ï‡∏¥‡πä‡∏Å isParallelSplit = true)
            [B] ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ edge ‡πÄ‡∏õ‡πá‡∏ô Conditional / ‡∏õ‡∏£‡∏±‡∏ö topology
        ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£ ‚Üí block ‡∏Å‡∏≤‡∏£ save
```

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡∏ñ‡πâ‡∏≤ outgoing edges > 1 ‡πÅ‡∏ï‡πà **‡∏ó‡∏∏‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô conditional/decision** (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Decision Node) ‚Üí validation ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡πä‡∏Å parallel
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Decision Node ‡πÅ‡∏ö‡∏ö node type ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° "Decision/Conditional" ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô

### 1.3 Validation: Merge Node ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢ Incoming Edges

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö node ‡∏ó‡∏µ‡πà `isMergeNode = true`:

1. ‡∏ô‡∏±‡∏ö incoming edges
2. ‡∏ñ‡πâ‡∏≤ incomingEdgesCount < 2 ‚Üí ‡πÅ‡∏™‡∏î‡∏á error ‡πÅ‡∏•‡∏∞ block save:

> "Merge node ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡πÄ‡∏™‡πâ‡∏ô"

3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ node ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô merge ‡∏ô‡∏±‡πâ‡∏ô **‡∏≠‡∏¢‡∏π‡πà downstream ‡∏Ç‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 parallel split** (optional enhancement):
   - ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á Warning (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á block) ‡∏ß‡πà‡∏≤:

> "Merge node ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á parallel split ‡πÉ‡∏î‡πÜ ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ merge ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà"

---

## 2. Backend ‚Äì Graph Validation in `dag_routing_api.php`

‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å:

- `source/dag_routing_api.php`

### 2.1 Reject node_type Legacy: `split`, `join`, `wait`

‡πÉ‡∏ô endpoint ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏ö node config ‡∏´‡∏£‡∏∑‡∏≠ save graph (‡πÄ‡∏ä‡πà‡∏ô `saveGraph`, `node_update`, `node_create`):

- ‡∏ñ‡πâ‡∏≤ payload ‡∏°‡∏µ `node_type` ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô:
  - `split`
  - `join`
  - `wait`

‡πÉ‡∏´‡πâ return error code ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏ä‡πà‡∏ô:

- `DAG_INVALID_NODE_TYPE`

‡πÅ‡∏•‡∏∞ log ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡πà‡∏≤‡∏ô logging helper ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß

> **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
> - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡∏ö node type ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å DB ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å graphs ‡πÄ‡∏Å‡πà‡∏≤  
> - ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ *‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å UI ‡∏´‡∏£‡∏∑‡∏≠ API ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

### 2.2 Server-side Validation: Multi Outgoing Edge

‡πÅ‡∏°‡πâ frontend ‡∏à‡∏∞ validate ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà backend ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥ (defensive programming):

- ‡πÇ‡∏´‡∏•‡∏î node + edges ‡∏Ç‡∏≠‡∏á graph ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞ save
- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ node:
  - ‡∏ô‡∏±‡∏ö outgoing edges ‡∏à‡∏≤‡∏Å routing_edge (‡∏´‡∏£‡∏∑‡∏≠ table edge ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á)
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö field:
    - `is_parallel_split`
  - ‡∏ï‡∏£‡∏ß‡∏à edge type/condition ‡∏ñ‡πâ‡∏≤ schema ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö

Logic ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠:

```php
if ($outgoingEdgesCount > 1) {
    if (!$node['is_parallel_split'] && !$hasConditionalEdges) {
        throw new DagValidationException('DAG_INVALID_PARALLEL_INTENT', 'Node has multiple outgoing edges but is neither parallel nor conditional.');
    }
}
```

- ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ error code ‡∏ó‡∏µ‡πà‡∏™‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô:
  - `DAG_INVALID_PARALLEL_INTENT`
  - `DAG_INVALID_SPLIT_NODE`

‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å log ‡∏ú‡πà‡∏≤‡∏ô logging helper ‡πÄ‡∏î‡∏¥‡∏°

### 2.3 Server-side Validation: Merge Node

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö node ‡∏ó‡∏µ‡πà‡∏°‡∏µ `is_merge_node = 1`:

- ‡∏ï‡∏£‡∏ß‡∏à incoming edge count
- ‡∏ñ‡πâ‡∏≤ < 2 ‚Üí `DAG_INVALID_MERGE_NODE`
- (Optional) ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á ancestor node ‡∏ó‡∏µ‡πà `is_parallel_split = 1`

---

## 3. Documentation Update

### 3.1 ‡πÄ‡∏û‡∏¥‡πà‡∏° Section ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Task 17 Results ‡∏´‡∏£‡∏∑‡∏≠ DAG Guide

‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:

- `docs/super_dag/tasks/task17_results.md`
- ‡∏´‡∏£‡∏∑‡∏≠ `docs/super_dag/DAG_IMPLEMENTATION_GUIDE.md`

‡πÄ‡∏û‡∏¥‡πà‡∏° section ‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡πà‡∏≤:

- ‡∏Å‡∏£‡∏≤‡∏ü‡∏ó‡∏µ‡πà‡∏°‡∏µ node ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏≠‡∏≠‡∏Å **‡∏ï‡πâ‡∏≠‡∏á** ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô:
  - Parallel Split  
  - ‡∏´‡∏£‡∏∑‡∏≠ Decision/Conditional
- Node ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏à‡∏ï‡∏ô‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô validation
- Node ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó `split`, `join`, `wait` ‡πÄ‡∏õ‡πá‡∏ô Legacy ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å UI/API ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏° style ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÑ‡∏î‡πâ):

> "Starting from Task 17.2, Super DAG enforces explicit intent for branching:
> - Nodes with multiple outgoing edges must be either marked as `is_parallel_split = 1` or use conditional/decision edges.  
> - Nodes with `is_merge_node = 1` must have at least two incoming edges.  
> Legacy control node types (`split`, `join`, `wait`) are deprecated and cannot be created via UI/API. Existing graphs remain readable but new graphs must follow the new semantics."

---

# üõ° Safety & Non-breaking Requirements

1. **‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö field legacy ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DB ‡πÉ‡∏ô Task ‡∏ô‡∏µ‡πâ**  
   - ‡πÄ‡∏ä‡πà‡∏ô `join_type`, `split_policy`, `join_quorum`, `wait_window_minutes` ‡∏Ø‡∏•‡∏Ø

2. **‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö logic legacy ‡πÉ‡∏ô service ‡∏ä‡∏±‡πâ‡∏ô‡∏•‡∏∂‡∏Å‡πÉ‡∏ô Task ‡∏ô‡∏µ‡πâ**  
   - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ legacy adapter ‡∏´‡∏£‡∏∑‡∏≠ schedule service ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô field ‡∏û‡∏ß‡∏Å‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏Ñ‡∏á behavior ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ

3. **Task 17.2 ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏Ñ‡πà UI + Validation Layer**  
   - ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà ambiguous  
   - ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤

4. **‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠ node_type = split/join/wait ‡πÉ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤**  
   - ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á read-only ‡πÑ‡∏î‡πâ  
   - ‡πÅ‡∏ï‡πà‡∏´‡πâ‡∏≤‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏´‡πâ‡∏≤‡∏° clone ‡πÄ‡∏õ‡πá‡∏ô node ‡πÉ‡∏´‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô graph editor

---

# ‚úÖ Summary

Task 17.2 ‡∏ó‡∏≥‡πÉ‡∏´‡πâ SuperDAG:

- ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏à‡∏ï‡∏ô‡∏≤‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å node
  - ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å "‡∏ó‡∏≥‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô" ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡πä‡∏Å Parallel Split
  - ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á" ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Decision/Conditional ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô merge node ‡∏ó‡∏µ‡πà topology ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏•‡πâ‡∏≤‡∏á UX ‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô Node Split/Join/Wait ‡πÅ‡∏ö‡∏ö legacy ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å UI ‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô API

‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏ö‡∏™‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ graph ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ï‡∏≤‡∏° SuperDAG Model ‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Task 18‚Äì20 ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢