# Task 14.1.7 ‚Äî Pre‚ÄëCleanup Migration Consolidation Framework  
**Status:** READY  
**Objective:** ‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Migration ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÇ‡∏î‡∏¢ *‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞ Legacy ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö* ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Master Schema Cleanup ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

---

## üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Task 14.1.7
1. ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‚ÄúMigration Layering‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Deploy ‡πÅ‡∏•‡πâ‡∏ß DB ‡πÄ‡∏î‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö
2. ‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÑ‡∏ü‡∏•‡πå migration ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
3. ‡πÅ‡∏¢‡∏Å ‚ÄúActive Migrations‚Äù / ‚ÄúLegacy Migrations‚Äù / ‚ÄúLocked Migrations‚Äù
4. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:  
   - ‡πÑ‡∏°‡πà‡∏•‡∏ö  
   - ‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç  
   - ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥  
   ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö `stock_item`, `id_stock_item`, routing V1, bom_line, dual-write

---

## üóÇÔ∏è Directory Structure (New Standard)
```
database/
‚îî‚îÄ‚îÄ tenant_migrations/
    ‚îú‚îÄ‚îÄ 0001_init_tenant_schema_v2.php
    ‚îú‚îÄ‚îÄ 0002_seed_data.php
    ‚îú‚îÄ‚îÄ active/
    ‚îÇ   ‚îú‚îÄ‚îÄ 2025_12_component_system_*.php
    ‚îÇ   ‚îú‚îÄ‚îÄ 2025_12_dag_behavior_*.php
    ‚îÇ   ‚îú‚îÄ‚îÄ 2025_12_leather_grn_*.php
    ‚îÇ   ‚îú‚îÄ‚îÄ 2025_12_material_lot_id_material.php
    ‚îÇ   ‚îú‚îÄ‚îÄ 2025_12_performance_indexes_*.php
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îú‚îÄ‚îÄ locked/
    ‚îÇ   ‚îú‚îÄ‚îÄ 2025_12_master_schema_v2_cleanup.php
    ‚îÇ   ‚îú‚îÄ‚îÄ legacy_routing/
    ‚îÇ   ‚îî‚îÄ‚îÄ legacy_stock/
    ‚îî‚îÄ‚îÄ archive/
```

---

## üß© Rules: ‚Äú‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞‡∏ï‡πâ‡∏≠‡∏á‚Äù ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢
### üîí **Locked Migrations (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ / ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö / ‡∏´‡πâ‡∏≤‡∏°‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥)**
- master_schema_v2_cleanup.php (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏¢‡∏±‡∏á‡∏°‡∏µ dependencies)
- migration ‡πÉ‡∏î‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö:
  - `stock_item`
  - `id_stock_item`
  - routing V1 tables
  - bom_line (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô active, but related legacy unsafe)
  - dual-write patterns

> Locked files = ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ ‚Äúmove directory only‚Äù, ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤

---

## üßπ Rules: Active Migrations (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö:
- component system
- dag behavior
- serial generation
- work_center_behavior
- leather GRN unified flow
- sheet usage
- performance indexes

‚Üí ‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ `/active/`

---

## üì¶ Rules: Archived Migrations
‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà:
- deploy ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏ô Production DB
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏≠‡∏µ‡∏Å
- ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥

‚Üí ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤ `/archive/`

---

## üõ°Ô∏è Safeguards ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
### 1. Hard guardrail ‡πÉ‡∏ô consolidated migration
‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡πÄ‡∏ä‡πà‡∏ô:

```php
if ($this->columnExists('material_lot', 'id_stock_item')) {
    // ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö‡πÉ‡∏ô Phase ‡∏ô‡∏µ‡πâ
    error_log('[SAFEGUARD] id_stock_item still exists ‚Äî skipping destructive cleanup');
}
```

### 2. Preventive inline comment
‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå locked migration ‡∏à‡∏∞ prepend:

```php
// ‚ö†Ô∏è LOCKED MIGRATION ‚Äî DO NOT MODIFY OR RE-RUN
// This file contains legacy-bound schema. It will be cleaned only after Phase 3.
```

### 3. Migration Integrity Map (auto-generated)
‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå:
`docs/migration/migration_integrity_map.md`

‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:
- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á mapping migration ‚Üí dependencies
- critical flags
- safe-to-edit flags
- safe-to-move directory flags

---

## üìò ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á Task 14.1.7
- Migration directory ‡∏™‡∏∞‡∏≠‡∏≤‡∏î ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÅ‡∏¢‡∏Å‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- Deploy ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ ‚Äú‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô schema‚Äù
- Ready for Task 14.3 (Dual-write removal)
- Ready for Task 15 (Final Schema Cleanup)
- ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏û‡∏±‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏ö‡∏ö Phase 14.2 ‡πÄ‡∏î‡∏¥‡∏°‡∏•‡∏á 95%

---

## ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô (‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô Task 14.1.7)
- All migrations grouped by lifecycle state
- All locked files protected
- All active migrations isolated
- Archive folder populated
- Safeguards injected
- Migration Integrity Map generated

---

## üìå Next Steps (‡∏´‡∏•‡∏±‡∏á 14.1.7)

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á migration ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á Phase 14 ‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ‚Äú‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‚Äù ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

### 14.1.8 ‚Äî Dual-Write Removal Preparation (Phase 1)
**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î ‚Äú‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ã‡πâ‡∏≥ 2 column‚Äù ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞ schema

- ‡πÅ‡∏¢‡∏Å logic read/write ‡∏Ç‡∏≠‡∏á legacy vs V2 ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô‡πÉ‡∏ô:
  - `leather_grn.php`
  - `materials.php`
  - service ‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏∞ `material_lot`
- ‡πÉ‡∏™‡πà feature flag / config (‡πÄ‡∏ä‡πà‡∏ô `MATERIAL_V2_MODE`) ‡πÄ‡∏û‡∏∑‡πà‡∏≠ control ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°
- ‡∏ó‡∏≥ adapter ‡πÉ‡∏´‡πâ‡∏¢‡∏±‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö schema ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏ö column)

> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö dual-write ‡∏ï‡∏£‡∏á‡πÜ ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà database ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà (legacy + V2)

---

### 14.1.9 ‚Äî Dual-Write Removal Activation (Phase 2)
**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô single-source-of-truth ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö application

- ‡πÄ‡∏õ‡∏¥‡∏î flag ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà column legacy
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á V2 column/table ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡πÉ‡∏™‡πà guardrail: ‡∏ñ‡πâ‡∏≤ request ‡πÑ‡∏´‡∏ô‡∏¢‡∏±‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏ä‡πâ legacy path ‚Üí log ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô / block

> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ data ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô V2 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÅ‡∏ï‡πà schema legacy ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö)

---

### 14.1.10 ‚Äî Legacy Read-Fallback Removal (Phase 3)
**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ legacy table/column ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å endpoint

- ‡∏•‡∏ö pattern ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:
  - `COALESCE(material.id_material, stock_item.id_stock_item)`
  - `LEFT JOIN stock_item` ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô fallback
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ endpoint ‡πÅ‡∏•‡∏∞ service ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÉ‡∏ä‡πâ V2 schema ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‡∏•‡∏ö adapter / fallback ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô routing adapter ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á)

> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡∏£‡∏∞‡∏ö‡∏ö read/write ‡∏à‡∏≤‡∏Å V2 schema ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÅ‡∏•‡πâ‡∏ß legacy ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà ‚Äú‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô DB‚Äù

---

### 14.1.11 ‚Äî Schema Cleanup Preparation (Phase 4)
**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° database ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ drop table/column ‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÇ‡∏î‡∏¢‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà drop

- ‡∏ó‡∏≥ integrity scan:
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö foreign key / index / view / trigger ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á legacy
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö usage (‡πÄ‡∏ä‡πà‡∏ô query count, log-based verification ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô `pre_cleanup_report.md` ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£ droppable / ‡∏≠‡∏∞‡πÑ‡∏£‡∏¢‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö
- ‡∏™‡∏£‡πâ‡∏≤‡∏á migration ‚Äúdry-run‚Äù ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ drop ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡πÑ‡∏ß‡πâ (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô blueprint ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)

> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ‡∏£‡∏π‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ß‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞ drop ‡∏à‡∏£‡∏¥‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ï‡∏∞‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô

---

### 14.1.12 ‚Äî Final Safe Schema Cleanup Execution (Phase 5)
**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡∏ó‡∏≥ destructive migration ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á 100%

- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô environment ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡πÇ‡∏î‡∏¢‡∏°‡∏µ guard ‡πÄ‡∏ä‡πà‡∏ô:
  ```php
  if (!defined('ENABLE_FINAL_SCHEMA_CLEANUP')) {
      throw new Exception('Final schema cleanup disabled');
  }
  ```
- Drop ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô `pre_cleanup_report.md` ‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ dependency:
  - columns ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á ‡πÜ
  - tables legacy ‡∏ó‡∏µ‡πà confirm ‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å code ‡πÅ‡∏•‡πâ‡∏ß
  - index ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å schema ‡πÄ‡∏î‡∏¥‡∏°
- Log ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ backup DB ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏™‡∏°‡∏≠

> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: Master Schema V2 ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå, legacy schema ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏ß‡∏≤‡∏î‡∏≠‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö roadmap ‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß (super_dag, component pipeline V2, warehouse V2 ‡∏Ø‡∏•‡∏Ø)

---

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö 14.1.8‚Äì14.1.12 ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞:
- ‡πÑ‡∏°‡πà‡∏°‡∏µ dual-write ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô code
- ‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ú‡πà‡∏≤‡∏ô V2 schema ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡∏•‡∏ö legacy schema ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£ ‚Äú‡∏û‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‚Äù ‡∏à‡∏≤‡∏Å cleanup ‡πÉ‡∏´‡∏ç‡πà ‡πÜ ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏•‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å