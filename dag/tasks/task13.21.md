

# Task 13.21 ‚Äî System Master Data Hardening (UOM / Work Center / Categories)

## Objective
‡∏™‡∏£‡πâ‡∏≤‡∏á ‚Äú‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‚Äù (Closed System Architecture) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Bellavier ERP ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Master Data ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (UOM, Work Center, Categories, Material Types, Warehouse Default) ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏•‡∏¥‡∏ï‡∏•‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏±‡πâ‡∏ô System Default + Guard Layer ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô iOS / Herm√®s Atelier System

---

## Phase 0 ‚Äî Legacy Cleanup & System Default Stabilization

‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° implement Lock / Guard ‡πÉ‡∏î ‡πÜ ‡πÉ‡∏ô Task 13.21 ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô "‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤" ‡πÅ‡∏•‡∏∞ "‡∏ï‡∏£‡∏∂‡∏á System Default" ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà tenant ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏°‡∏µ id / seed ‡∏Ç‡∏≠‡∏á UOM, Work Center, Warehouse, Categories ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô

### 0.1 Legacy Purge Procedure

1. ‡∏™‡πÅ‡∏Å‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• master data ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ tenant:
   - UOM ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - Work Center ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - Product Category / Material Category
   - Warehouse ‡πÅ‡∏•‡∏∞ Locations
2. ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°:
   - **System-critical** (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á map ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà System Default ‡πÉ‡∏´‡∏°‡πà)
   - **Legacy / Demo / Test / ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á** (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö/‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ)
3. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á:
   - ‡∏ó‡∏≥ soft delete ‡∏´‡∏£‡∏∑‡∏≠ purge ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (‡∏ï‡∏≤‡∏° policy ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î)
   - ‡∏ï‡πâ‡∏≠‡∏á log ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á `task13.21_results.md` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ

> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ **‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ï‡∏∞ permissions** ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö security/roles ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏•‡∏∞ layer

### 0.2 Reset AUTO_INCREMENT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö System Master Tables

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ System Default ‡∏°‡∏µ id ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å tenant ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î policy ‡∏ß‡πà‡∏≤:

- id 1‚Äì99 ‡∏™‡∏á‡∏ß‡∏ô‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **System Default Master Data** ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- id >= 100 ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà user ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

1. ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• master tables ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (backup / export ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
2. ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô System Default ‡∏à‡∏£‡∏¥‡∏á ‡πÜ
3. Reset AUTO_INCREMENT ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á:
   - `uom`
   - `work_center`
   - `warehouse`
   - `warehouse_location`
   - `product_category` (‡πÅ‡∏•‡∏∞ `material_category` **‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô schema**)  
‡∏´‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á `material_category` ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á tenant ‡πÉ‡∏´‡πâ migration/‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡πâ‡∏≤‡∏° assume ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
4. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ AUTO_INCREMENT ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 100 (‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ id 1‚Äì99 ‡πÄ‡∏õ‡πá‡∏ô reserved zone ‡∏Ç‡∏≠‡∏á System Default

### 0.3 Create New System Default Seed Migration

‡∏™‡∏£‡πâ‡∏≤‡∏á migration ‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ä‡πà‡∏ô `2025_XX_create_system_master_seeds.php`) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

- Idempotent: ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥
- ‡πÉ‡∏ä‡πâ code ‡∏ó‡∏µ‡πà deterministic ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö id ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ `is_system = 1`, `locked = 1` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å row ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô System Default

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á seed:

- **UOM**:
  - CM, MM, CM2, SQUARE_METER, SQFT, SHEET, PCS
- **Work Center**:
  - CUT, SEW, QC_INITIAL, QC_FINAL, PACK (‡πÅ‡∏•‡∏∞ node ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô DAG ‡∏à‡∏£‡∏¥‡∏á)
- **Material Types**:
  - LEATHER, CANVAS, LINING, FOAM (‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ï‡∏≤‡∏° schema ‡∏à‡∏£‡∏¥‡∏á)
- **Warehouse & Locations**:
  - MAIN warehouse
  - RAW location
  - WIP location
  - FINISHED location
- **Product / Material Categories**:
  - ROOT categories ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ (BAG, ACCESSORY, PART, MATERIAL ‡∏Ø‡∏•‡∏Ø ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏ß‡πâ)

### 0.4 Deprecate / Disable Legacy Seed Migrations

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£ seed ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á master data ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Å‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï:

- ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå migration ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢ insert UOM, Work Center, Warehouse, Categories
- Mark ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô **deprecated** ‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠
- ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö migration ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (schema) ‡πÇ‡∏î‡∏¢‡∏¢‡πâ‡∏≤‡∏¢ logic ‡∏Å‡∏≤‡∏£ insert ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• default ‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô System Default Seed Migration ‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ó‡∏ô

### 0.5 Tenant Initialization Script

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå/‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å tenant:

1. ‡∏£‡∏±‡∏ô Legacy Purge Procedure (0.1)
2. Reset AUTO_INCREMENT ‡∏ï‡∏≤‡∏° policy (0.2)
3. ‡∏£‡∏±‡∏ô System Default Seed Migration (0.3)
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤:
   - UOM default ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡∏∞‡∏°‡∏µ `is_system = 1`, `locked = 1`
   - Work Center default ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡∏∞‡∏°‡∏µ `is_system = 1`, `locked = 1`
   - Warehouse / Locations default ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å lock
   - Categories default ‡∏Ñ‡∏£‡∏ö
5. Log ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡πà‡∏≠ tenant ‡∏•‡∏á‡πÉ‡∏ô `task13.21_results.md` ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå log ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏£‡∏∞‡∏ö‡∏ö

---

## Risk Assessment & Mitigation (‡∏à‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î)

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å Task 13.21 ‡πÄ‡∏õ‡πá‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (infrastructure-level) ‡∏à‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏∂‡∏á‡∏™‡∏π‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏° risk ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á

### Risk 1 ‚Äî ‡∏•‡∏ö/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô master data ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• production ‡πÄ‡∏î‡∏¥‡∏°

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
- ‡∏°‡∏µ work_center, uom, category, warehouse ‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô production ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏ñ‡∏π‡∏Å purge ‡∏´‡∏£‡∏∑‡∏≠ reset ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- Foreign key ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô orphan
- Token/Job/GRN/Stock ledger ‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á id ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏ß‡πâ‡∏≤‡∏á

**Mitigation:**
- ‡∏Å‡πà‡∏≠‡∏ô purge ‡πÉ‡∏î ‡πÜ ‡∏ï‡πâ‡∏≠‡∏á:
  - ‡∏™‡πÅ‡∏Å‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á (FK usage) ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ master data
  - ‡∏ñ‡πâ‡∏≤ record ‡∏ô‡∏±‡πâ‡∏ô‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á transactional ‚Üí ‡∏´‡πâ‡∏≤‡∏° purge ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÉ‡∏´‡πâ mark ‡πÄ‡∏õ‡πá‡∏ô `legacy_mapped` ‡πÅ‡∏•‡∏∞ map ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö System Default ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
- ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡πâ ‚Äú‡πÅ‡∏õ‡∏•‡∏á/‡πÅ‡∏°‡∏û‚Äù ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ ‚Äú‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á‚Äù ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏°‡∏µ usage ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
- ‡∏ó‡∏≥ full DB backup ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô Phase 0 ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

### Risk 2 ‚Äî AUTO_INCREMENT Reset ‡∏ó‡∏≥‡πÉ‡∏´‡πâ id ‡∏ä‡∏ô/‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• master/transaction ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏Å‡∏≤‡∏£ reset AUTO_INCREMENT ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- Insert ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏≤‡∏à‡∏ä‡∏ô‡∏Å‡∏±‡∏ö id ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£ manipulate id ‡πÅ‡∏ö‡∏ö manual)
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≤‡∏à‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ö‡∏≤‡∏á record ‡πÄ‡∏õ‡πá‡∏ô System Default ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ô

**Mitigation:**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ "set id manual" ‡πÉ‡∏ô master tables ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
- ‡πÉ‡∏ä‡πâ policy: id 1‚Äì99 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö System Default ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏° AUTO_INCREMENT ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡∏≠‡∏≤‡∏à‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 100 ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á)
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô migration ‡πÉ‡∏´‡πâ idempotent ‡πÅ‡∏•‡∏∞‡∏°‡∏µ sanity check ‡∏Å‡πà‡∏≠‡∏ô reset

### Risk 3 ‚Äî System Default Seed ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠ ambiguity

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
- ‡∏°‡∏µ UOM code = 'CM' ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ `is_system`/`locked`
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô System Default Seed Migration ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î row ‡∏ã‡πâ‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏á

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- ‡∏™‡∏≠‡∏á record ‡∏ó‡∏µ‡πà‡∏°‡∏µ code ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
- Engine ‡∏≠‡∏≤‡∏à‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏ú‡∏¥‡∏î‡∏ï‡∏±‡∏ß ‡∏´‡∏≤‡∏Å query ‡∏î‡πâ‡∏ß‡∏¢ code ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

**Mitigation:**
- ‡πÉ‡∏ô System Default Seed Migration:
  - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å `code` ‡∏Å‡πà‡∏≠‡∏ô ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ update ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô `is_system = 1`, `locked = 1` ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ insert ‡πÉ‡∏´‡∏°‡πà
  - ‡∏ñ‡πâ‡∏≤‡∏û‡∏ö‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 record ‡∏ï‡πà‡∏≠ code ‚Üí log ‡πÄ‡∏õ‡πá‡∏ô critical issue ‡πÉ‡∏ô `task13.21_results.md` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ manual ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
- ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ engine ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á `code` + `is_system = 1` ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ resolve ‡∏Ñ‡πà‡∏≤ system default

### Risk 4 ‚Äî Tenant ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏°‡∏µ schema/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• master ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏•‡πâ‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏≤‡∏á

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
- dev, staging, prod, ‡∏´‡∏£‡∏∑‡∏≠ tenants ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏°‡∏µ UOM/work_center/warehouse ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏≠‡∏î‡∏µ‡∏ï
- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå purge/seed ‡∏ñ‡∏π‡∏Å‡∏£‡∏±‡∏ô‡πÇ‡∏î‡∏¢ assume ‡∏ß‡πà‡∏≤ schema ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- Migration fail ‡∏ö‡∏≤‡∏á tenant
- state ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏¢‡∏¥‡πà‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°

**Mitigation:**
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÉ‡∏´‡πâ robust ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô:
  - ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≤‡∏î column ‚Üí ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏° error ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
  - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö code ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‚Üí log ‡πÅ‡∏•‡∏∞ mark tenant ‡∏ô‡∏µ‡πâ‡∏ß‡πà‡∏≤ "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ manual intervention"
- ‡∏£‡∏±‡∏ô‡πÉ‡∏ô dev/staging ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å tenant representative ‡∏Å‡πà‡∏≠‡∏ô prod
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡πà‡∏≠ tenant ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô log ‡∏Å‡∏•‡∏≤‡∏á

### Risk 5 ‚Äî ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å code-based logic ‚Üí id-based logic ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏û‡∏±‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ï‡∏±‡∏ß

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô (‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Legacy) ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ `code` ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô logic
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ id-based ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏±‡∏ö

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- Behavior ‡∏ö‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ï‡∏±‡∏ß
- ‡∏ö‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏´‡∏≤‡∏¢‡πÑ‡∏õ/‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

**Mitigation:**
- ‡∏ó‡∏≥ code search ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° (‡πÉ‡∏ô repo ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÄ‡∏ä‡πà‡∏ô `uom_code`, `work_center_code`, `category_code` ‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô list ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á refactor
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô Task 13.22 ‡πÉ‡∏´‡πâ‡∏°‡∏µ phase "Code Refactor & Verification" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö logic ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
- ‡πÄ‡∏û‡∏¥‡πà‡∏° logging ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÉ‡∏ô layer resolver (‡πÄ‡∏ä‡πà‡∏ô UomResolver, WorkCenterResolver) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏´‡∏•‡∏∏‡∏î code-based ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

---
## Background
‡πÉ‡∏ô Legacy ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç code ‡∏Ç‡∏≠‡∏á UOM
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Work Center
- ‡∏•‡∏ö Product Category / Team Category
- ‡πÅ‡∏Å‡πâ Material Type
- ‡πÅ‡∏Å‡πâ Warehouse MAIN ‡πÅ‡∏•‡∏∞ RAW location

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‚Üí DAG Routing, CUT pipeline, GRN, Stock Card, QC, BOM, Material Resolver ‡∏û‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ú‡∏á

Task 13.21 ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ ‚Äú‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà deterministic, stable ‡πÅ‡∏•‡∏∞ production-safe

---

## Scope
- Lock UOM system default
- Lock Work Center system default
- Lock Warehouse & Locations required by system
- Add Guard Layer for all master data APIs
- Switch engine references from code ‚Üí id
- Add soft-delete (no hard delete)
- Add metadata flags ‚Äúis_system‚Äù, ‚Äúlocked‚Äù
- Update UI to hide edit/delete for system data

---

## Deliverables

### 1. Database Migration
‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

#### UOM table
- ‡πÄ‡∏û‡∏¥‡πà‡∏° column:
  - `is_system` TINYINT(1) default 0
  - `locked` TINYINT(1) default 0
- Mark ‡∏Ñ‡πà‡∏≤ system default:
  - cm
  - mm
  - cm2
  - square_meter
  - sqft
  - sheet
  - pcs
- ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö:
  - ‡∏ñ‡πâ‡∏≤ `locked = 1` ‚Üí ‡∏´‡πâ‡∏≤‡∏° update code/name
  - ‡∏ñ‡πâ‡∏≤ `locked = 1` ‚Üí ‡∏´‡πâ‡∏≤‡∏° delete (soft delete only)

#### Work Center table
‡πÄ‡∏û‡∏¥‡πà‡∏° column:
- `is_system`
- `locked`

Mark ‡∏Ñ‡πà‡∏≤ system default:
- CUT
- QC_INITIAL
- QC_FINAL
- SEWING / OPERATION (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô DAG)

#### Product Category / Material Category (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á environment ‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á `material_category` ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô migration ‡πÅ‡∏ö‡∏ö defensive ‡∏Ñ‡∏∑‡∏≠: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ `product_category` ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á `material_category` ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
‡πÄ‡∏û‡∏¥‡πà‡∏°:
- `is_system`
- `locked`
- Soft delete (deleted_at)

#### Warehouse / Locations
‡πÄ‡∏û‡∏¥‡πà‡∏°:
- `is_system`
- `locked`

Mark ‡∏Ñ‡πà‡∏≤ system default:
- Warehouse MAIN
- Location RAW
- Location WIP
- Location FINISHED

---

### 2. API Guard Layer

‡∏™‡∏£‡πâ‡∏≤‡∏á middleware/validator ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å API:
- ‡∏ñ‡πâ‡∏≤ `is_system = 1`:
  - reject update
  - reject delete
  - reject code change
  - allow name-change ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ display ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ (optional)

Error template:
```
{
  "ok": false,
  "error": "master_data_locked",
  "message": "This is system master data and cannot be modified."
}
```

---

### 3. UI Updates

#### List View
- Row ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô system default:
  - icon üîí
  - ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° Delete
  - ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° Edit Code
  - ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà critical

#### Edit Modal
- ‡∏ñ‡πâ‡∏≤ locked:
  - input fields disabled
  - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

---

### 4. Behavior Engine Patch

Update logic ‡πÉ‡∏´‡πâ ‚Äú‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å id ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‚Äù
- ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ code ‡∏Ç‡∏≠‡∏á UOM / work_center ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ó‡∏≤‡∏á logic
- Routing Engine, CUT Engine, Material Resolver ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å:
  - `id_work_center`
  - `id_uom`
  - `id_category`

---

### 5. Data Consistency Migration Step

1. ‡∏™‡πÅ‡∏Å‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Legacy ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
2. Map code ‚Üí id (‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á)
3. Log migration summary
4. Mark deprecated fields (code-based logic) ‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß

---

## Acceptance Criteria

- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ master data ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô system default ‡πÑ‡∏î‡πâ
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏î‡πâ‡∏ß‡∏¢ id-based ‡πÅ‡∏ó‡∏ô code-based
- Work Center / UOM / Categories ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å lock ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- DAG routing ‡πÅ‡∏•‡∏∞ CUT behavior ‡πÑ‡∏°‡πà‡∏•‡πà‡∏°‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• master data
- UI ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ locked + ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ
- Soft delete ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á master data
- Legacy code-based logic ‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô id-based

---

## Next Task 13.22
Migration Implementation Script:
- Material Resolver ID conversion
- Work Center reference fix
- UOM mapping migration
- DAG Node upgrade script