# üîÑ Rework Scrap & Replacement Token - ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

**Created:** November 2, 2025  
**Status:** Proposal (Draft)  
**Purpose:** ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà token ‡∏ñ‡∏π‡∏Å scrap (rework limit ‡∏ñ‡∏∂‡∏á)

---

## üìå ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ (Quick Reference)

### üéØ ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà: ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏¢‡∏≠‡∏∞?

**‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô DAG (‡πÑ‡∏°‡πà‡∏°‡∏µ loop)** ‚Üí Pattern ‡πÅ‡∏ö‡∏ö `QC ‚Üí Rework ‚Üí QC ‚Üí Rework ‚Üí ...` ‡∏ß‡∏≤‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏à‡∏∞‡∏ä‡∏ô rule "no cycle")

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
> "‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏ô node ‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å node ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô"

**Proposal ‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡∏ß‡πà‡∏≤:**
- **"rework ‡∏õ‡∏Å‡∏ï‡∏¥"** = ‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÑ‡∏õ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ã‡πà‡∏≠‡∏°
- **"‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡∏à‡∏£‡∏¥‡∏á‡πÜ"** = scrap + ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô / ‡∏ó‡∏µ‡πà node ‡πÑ‡∏´‡∏ô

---

### ‚úÖ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö 3 ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

#### 1) QC ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô? Rework node ‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏¢‡∏á‡∏Å‡∏•‡∏±‡∏ö node ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏´‡∏°?

**Flow ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:**
1. ‡∏ó‡∏µ‡πà QC node ‡∏°‡∏µ 2 edge ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢:
   - ‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡πÑ‡∏õ node ‡∏ï‡πà‡∏≠‡πÑ‡∏õ (‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö / ‡πÅ‡∏û‡πá‡∏Ñ / END)
   - ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡πÑ‡∏õ node ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "Rework Sink"

2. ‡∏ó‡∏µ‡πà Rework node ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≤‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á OP ‡πÄ‡∏î‡∏¥‡∏°
   - Runtime ‡∏à‡∏∞‡πÉ‡∏ä‡πâ policy ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏≠‡∏á‡∏ß‡πà‡∏≤ token ‡πÉ‡∏´‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏ó‡∏µ‡πà node ‡πÑ‡∏´‡∏ô
   - ‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∞‡πÑ‡∏£ (reason)

**‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:**
- ‚úÖ ‡πÉ‡∏ä‡πà ‚Äì QC fail ‡∏Ñ‡∏ß‡∏£‡πÇ‡∏¢‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà "Rework Sink"
- ‚úÖ ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ node ‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ engine ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà node ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
- ‚úÖ ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô DAG ‡∏™‡∏ß‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏°‡∏µ cycle

---

#### 2) Token ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ "‡∏ã‡πà‡∏≠‡∏°" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ö?"

**‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î:**

**Rework Token (‡πÅ‡∏ö‡∏ö‡πÉ‡∏ô `on_fail`):**
- ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà QC ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô
- ‡∏™‡∏£‡πâ‡∏≤‡∏á "token ‡πÉ‡∏´‡∏°‡πà" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ö‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏¢‡πá‡∏ö‡∏ã‡πà‡∏≠‡∏°, ‡∏ó‡∏≥‡∏Ç‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å START
- = "‡πÄ‡∏≠‡∏≤‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ô‡∏µ‡πà‡πÅ‡∏´‡∏•‡∏∞ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà X ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ"

**Replacement Token / Scrap Replacement (‡∏™‡πà‡∏ß‡∏ô `on_scrap`):**
- ‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏° "‡∏û‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏¢‡∏µ‡∏¢‡∏ß‡∏¢‡∏≤"
- ‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡∏π‡∏Å mark ‡∏ß‡πà‡∏≤ scrapped
- ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏à‡∏≤‡∏Å START ‡∏´‡∏£‡∏∑‡∏≠ CUT

**‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:**
- ‚ú≥Ô∏è "Rework ‡∏õ‡∏Å‡∏ï‡∏¥ = ‡∏ã‡πà‡∏≠‡∏°‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥‡∏ö‡∏≤‡∏á node ‡∏ã‡πâ‡∏≥‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏∂‡∏á rework limit ‡∏´‡∏£‡∏∑‡∏≠ QC ‡∏ú‡πà‡∏≤‡∏ô"
- ‚ú≥Ô∏è "Replacement = ‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å START ‡∏´‡∏£‡∏∑‡∏≠ CUT"

---

#### 3) ‡∏ñ‡πâ‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÉ‡∏ä‡πâ Proposal ‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á?

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:**
- Rework ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≠‡∏ö (rework_count >= MAX_REWORK_LIMIT)
- ‡∏´‡∏£‡∏∑‡∏≠ QC/‡∏ä‡πà‡∏≤‡∏á‡∏ï‡∏¥‡πä‡∏Å reason ‡∏ß‡πà‡∏≤ material_defect, cannot_repair

**Flow:**
1. Token ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡∏π‡∏Å mark ‡∏ß‡πà‡∏≤ scrapped
2. ‡πÄ‡∏Å‡∏¥‡∏î event `token_event(type='scrap', ...)`
3. ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏î‡∏π policy `on_scrap`

**Policy Modes (‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏Ñ‡∏ô):**

| Mode | Behavior |
|------|----------|
| **`manual`** | ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡∏Å‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏≠‡∏á (‡∏à‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å START ‡∏´‡∏£‡∏∑‡∏≠ CUT ‡∏Å‡πá‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà UI ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) |
| **`auto_spawn_from_start`** | Scrap ‡∏õ‡∏∏‡πä‡∏ö ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà START ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏¢ (= ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ö) |
| **`auto_spawn_from_cut`** | Scrap ‡∏õ‡∏∏‡πä‡∏ö ‚Üí token ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà node CUT (= ‡∏ï‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ routing ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡∏ô‡∏±‡πâ‡∏ô) |
| **`none`** | Scrap ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏ö‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô (‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô material loss ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥) |

**‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:**
- ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‚Üí ‡πÉ‡∏´‡πâ QC ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏≤‡∏á mark ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ß‡πà‡∏≤ "‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ / material defect"
- ‚úÖ Runtime ‡∏à‡∏∞ mark token ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô scrapped
- ‚úÖ ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏ï‡πà‡∏≠ "‡∏ï‡∏≤‡∏° on_scrap.mode" (‡∏à‡∏∞‡πÉ‡∏´‡πâ auto ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å START/CUT ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏≠‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ)

---

### üìù ‡∏™‡∏£‡∏∏‡∏õ Logic ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥ (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î)

**‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÅ‡∏õ‡∏∞‡πÉ‡∏ô‡∏´‡∏±‡∏ß AI Agent ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢:**

1. **QC fail ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ:**
   - ‡πÉ‡∏ä‡πâ `on_fail` ‚Üí spawn rework token
   - Rework token = ‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ö‡∏≤‡∏á node
   - ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ö‡∏ö DAG ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ loop

2. **QC fail ‡πÅ‡∏•‡∏∞ "‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡πÅ‡∏•‡πâ‡∏ß":**
   - Mark scrap (status = scrapped)
   - ‡πÉ‡∏ä‡πâ `on_scrap.mode` ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á "replacement token"
   - Replacement token = ‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å START ‡∏´‡∏£‡∏∑‡∏≠ CUT ‡∏ï‡∏≤‡∏° policy

3. **Rework Limit = ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà "scrap flow":**
   - rework_count >= MAX_REWORK_LIMIT ‚Üí ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ rework ‡∏≠‡∏µ‡∏Å
   - ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ `on_scrap` ‡πÄ‡∏™‡∏°‡∏≠

**‡∏Å‡∏é‡∏ó‡∏≠‡∏á:**
> **QC Fail ‚Üí Rework (‡∏ã‡πà‡∏≠‡∏°)**  
> **Scrap ‚Üí Replacement (‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà)**

---

## üìã Overview

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
‡πÄ‡∏°‡∏∑‡πà‡∏≠ token ‡∏ñ‡∏π‡∏Å rework ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏à‡∏ô‡∏ñ‡∏∂‡∏á `MAX_REWORK_LIMIT` ‚Üí token ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å scrap (‡∏ó‡∏¥‡πâ‡∏á)  
**‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å node ‡πÑ‡∏´‡∏ô?

### ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î policy ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ scrap tokens
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á manual ‡πÅ‡∏•‡∏∞ automatic replacement
- ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á policy ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö rework system

---

## üéØ Scenarios

### Scenario 1: Rework ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Normal Flow)
```
[QC ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô] ‚Üí [Rework Sink] ‚Üí spawn new token ‚Üí [‡πÄ‡∏¢‡πá‡∏ö] (‡∏ã‡πà‡∏≠‡∏°)
   ‚Üì
[QC ‡∏ú‡πà‡∏≤‡∏ô] ‚Üí [‡πÅ‡∏û‡πá‡∏Ñ] ‚Üí [END] ‚úÖ
```

### Scenario 2: Rework ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Rework Limit ‡∏ñ‡∏∂‡∏á)
```
[QC ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô] ‚Üí [Rework] ‚Üí [QC ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å] ‚Üí ... (rework_count = MAX)
   ‚Üì
[Token ‡∏ñ‡∏π‡∏Å scrap] ‚Üí Alert supervisor
   ‚Üì
‚ùì ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πà‡∏≠?
```

### Scenario 3: Material Defect (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏î‡πâ)
```
[QC ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô] ‚Üí [Rework] ‚Üí [‡∏û‡∏ö Material Defect]
   ‚Üì
[Token ‡∏ñ‡∏π‡∏Å scrap ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ] (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ limit)
   ‚Üì
‚ùì ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
```

---

## üí° Proposed Solution: Scrap Replacement Policy

### Policy Structure (‡∏Ç‡∏¢‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Rework Policy)

```json
{
  "on_fail": "spawn_new_token",
  "target_nodes": ["SEW", "EDG"],
  "strategy": "by_reason",
  "reason_mapping": {
    "QC_FAIL_STITCH": "SEW",
    "QC_FAIL_EDGE": "EDG"
  },
  
  // ‚ú® NEW: Scrap Replacement Policy
  "on_scrap": {
    "mode": "manual" | "auto_spawn_from_start" | "auto_spawn_from_cut" | "none",
    "require_approval": true | false,  // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö auto mode
    "notification": {
      "roles": ["supervisor", "manager"],
      "message_template": "Token {serial} scrapped after {count} rework attempts"
    }
  }
}
```

### Policy Modes

| Mode | Description | Use Case |
|------|-------------|----------|
| **`manual`** | Supervisor ‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏≠‡∏á | Default (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢) |
| **`auto_spawn_from_start`** | Auto spawn token ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà START | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| **`auto_spawn_from_cut`** | Auto spawn token ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà CUT | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà |
| **`none`** | ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà | ‡πÄ‡∏°‡∏∑‡πà‡∏≠ scrap = material loss (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà) |

---

## üîÑ Runtime Flow

### Flow 1: Rework Limit ‡∏ñ‡∏∂‡∏á (Auto Spawn)

```
1. Token rework_count >= MAX_REWORK_LIMIT
   ‚Üì
2. SET token.status = 'scrapped'
   CREATE token_event(type='scrap', metadata={...})
   ‚Üì
3. Check on_scrap.mode:
   
   IF mode = 'auto_spawn_from_start':
     ‚Üí Spawn new token at START node
     ‚Üí Link: new_token.parent_scrapped_token_id = old_token.id
     ‚Üí Log: "Replacement token spawned from START"
   
   IF mode = 'auto_spawn_from_cut':
     ‚Üí Spawn new token at CUT node
     ‚Üí Link: new_token.parent_scrapped_token_id = old_token.id
     ‚Üí Log: "Replacement token spawned from CUT"
   
   IF mode = 'manual':
     ‚Üí Send notification to supervisor
     ‚Üí Wait for manual token creation
   
   IF mode = 'none':
     ‚Üí Just log scrap (no replacement)
   ‚Üì
4. Send notification (if configured)
```

### Flow 2: Material Defect (Immediate Scrap)

```
1. Operator marks: "Material Defect - Cannot Rework"
   ‚Üì
2. SET token.status = 'scrapped'
   CREATE token_event(type='scrap', metadata={
     'reason': 'material_defect',
     'immediate': true
   })
   ‚Üì
3. Check on_scrap.mode:
   ‚Üí Same as Flow 1
   ‚Üì
4. If auto_spawn: Create replacement token immediately
```

---

## üìä Policy Examples

### Example 1: Manual Mode (Default - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
```json
{
  "on_fail": "spawn_new_token",
  "target_nodes": ["SEW"],
  "on_scrap": {
    "mode": "manual",
    "notification": {
      "roles": ["supervisor"],
      "message_template": "Token {serial} scrapped. Please create replacement token."
    }
  }
}
```

**Behavior:**
- Token scrap ‚Üí Alert supervisor
- Supervisor ‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏≠‡∏á (‡∏ú‡πà‡∏≤‡∏ô UI)
- ‡πÑ‡∏°‡πà auto spawn

---

### Example 2: Auto Spawn from START (‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
```json
{
  "on_fail": "spawn_new_token",
  "target_nodes": ["SEW"],
  "on_scrap": {
    "mode": "auto_spawn_from_start",
    "require_approval": false,
    "notification": {
      "roles": ["supervisor"],
      "message_template": "Token {serial} scrapped. Replacement token created at START."
    }
  }
}
```

**Behavior:**
- Token scrap ‚Üí Auto spawn token ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà START
- Token ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏ï‡πâ‡∏ô (‡∏ï‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà)
- Alert supervisor (informational)

---

### Example 3: Auto Spawn from CUT (‡∏ï‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà)
```json
{
  "on_fail": "spawn_new_token",
  "target_nodes": ["SEW"],
  "on_scrap": {
    "mode": "auto_spawn_from_cut",
    "require_approval": true,
    "notification": {
      "roles": ["supervisor", "manager"],
      "message_template": "Token {serial} scrapped. Replacement token created at CUT. Approval required."
    }
  }
}
```

**Behavior:**
- Token scrap ‚Üí Auto spawn token ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà CUT
- Token ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å CUT (‡∏ï‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà)
- Require supervisor approval before token starts
- Alert supervisor + manager

---

### Example 4: No Replacement (Material Loss)
```json
{
  "on_fail": "spawn_new_token",
  "target_nodes": ["SEW"],
  "on_scrap": {
    "mode": "none",
    "notification": {
      "roles": ["supervisor"],
      "message_template": "Token {serial} scrapped. No replacement (material loss)."
    }
  }
}
```

**Behavior:**
- Token scrap ‚Üí ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà
- Log material loss
- Alert supervisor (informational)

---

## üóÑÔ∏è Database Schema Changes

### 1. Add Field to `flow_token` Table

```sql
ALTER TABLE flow_token
ADD COLUMN parent_scrapped_token_id INT NULL COMMENT 'Reference to scrapped token (if this is a replacement)',
ADD COLUMN scrap_replacement_mode VARCHAR(50) NULL COMMENT 'How this token was created: manual, auto_start, auto_cut',
ADD INDEX idx_parent_scrapped (parent_scrapped_token_id);

-- Foreign key (optional, for referential integrity)
ALTER TABLE flow_token
ADD CONSTRAINT fk_parent_scrapped
FOREIGN KEY (parent_scrapped_token_id) REFERENCES flow_token(id_token)
ON DELETE SET NULL;
```

### 2. Add Field to `token_event` Metadata

```json
{
  "event_type": "scrap",
  "metadata": {
    "reason": "max_rework_exceeded",
    "rework_count": 3,
    "limit": 3,
    "replacement_mode": "auto_spawn_from_start",
    "replacement_token_id": 123  // If auto spawned
  }
}
```

---

## üé® UI/UX Considerations

### 1. Designer UI (Policy Configuration)

**QC Node Properties Panel:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ QC Node: QC1                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ... (existing fields) ...          ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ ‚ú® Scrap Replacement Policy:       ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ Mode: [Manual ‚ñº]                ‚îÇ ‚îÇ
‚îÇ ‚îÇ                                  ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚òë Require Approval               ‚îÇ ‚îÇ
‚îÇ ‚îÇ                                  ‚îÇ ‚îÇ
‚îÇ ‚îÇ Notification Roles:              ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚òë Supervisor                     ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚òê Manager                        ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Supervisor Dashboard (Manual Token Creation)

**Scrap Alert Card:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö†Ô∏è Token Scrapped                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Serial: TOTE-001-05                 ‚îÇ
‚îÇ Reason: Max rework exceeded (3/3)  ‚îÇ
‚îÇ Scrapped At: 2025-11-02 14:30      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ [Create Replacement Token]         ‚îÇ
‚îÇ   ‚îî‚îÄ Target: [START ‚ñº]             ‚îÇ
‚îÇ   ‚îî‚îÄ [Create]                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3. Token History View

**Token Details:**
```
Token: TOTE-001-05
Status: Scrapped
‚îú‚îÄ Created: 2025-11-02 10:00
‚îú‚îÄ Rework Count: 3
‚îú‚îÄ Scrapped: 2025-11-02 14:30
‚îî‚îÄ Replacement: TOTE-001-05-REPLACE (Created at START)
```

---

## üîß Implementation Phases

### Phase 1: Manual Mode Only (Simple)

**Scope:**
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `on_scrap.mode = "manual"` ‡πÉ‡∏ô policy
- ‡πÄ‡∏û‡∏¥‡πà‡∏° notification ‡πÄ‡∏°‡∏∑‡πà‡∏≠ scrap
- ‡πÄ‡∏û‡∏¥‡πà‡∏° UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö supervisor ‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà

**Effort:** 2-3 hours  
**Risk:** Low (‡πÑ‡∏°‡πà auto spawn)

---

### Phase 2: Auto Spawn (Full Feature)

**Scope:**
- ‡πÄ‡∏û‡∏¥‡πà‡∏° `auto_spawn_from_start` ‡πÅ‡∏•‡∏∞ `auto_spawn_from_cut` modes
- ‡πÄ‡∏û‡∏¥‡πà‡∏° runtime logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö auto spawn
- ‡πÄ‡∏û‡∏¥‡πà‡∏° approval flow (if require_approval = true)

**Effort:** 4-6 hours  
**Risk:** Medium (‡∏ï‡πâ‡∏≠‡∏á test auto spawn logic)

---

### Phase 3: Advanced Features (Future)

**Scope:**
- Scrap reason mapping (material_defect ‚Üí auto_spawn_from_cut)
- Conditional replacement (by reason)
- Replacement token tracking & analytics

**Effort:** 6-8 hours  
**Risk:** Low (optional features)

---

## ‚úÖ Validation Rules

### Policy Validation

1. **on_scrap.mode** must be one of: `manual`, `auto_spawn_from_start`, `auto_spawn_from_cut`, `none`
2. **require_approval** only applies to auto modes
3. **notification.roles** must be valid role codes
4. **START node** must exist in graph (if using `auto_spawn_from_start`)
5. **CUT node** must exist in graph (if using `auto_spawn_from_cut`)

### Runtime Validation

1. Check `rework_count >= MAX_REWORK_LIMIT` before scrap
2. Verify target node (START/CUT) exists before auto spawn
3. Ensure replacement token serial is unique
4. Link parent_scrapped_token_id correctly

---

## üìù Documentation Updates Needed

### 1. QC_VS_DECISION_NODES.md
- ‡πÄ‡∏û‡∏¥‡πà‡∏° section "Scrap Replacement Policy"
- ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ policy modes
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### 2. BELLAVIER_DAG_RUNTIME_FLOW.md
- ‡πÄ‡∏û‡∏¥‡πà‡∏° "Phase 7.5: Scrap & Replacement"
- ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ runtime flow
- Token lifecycle diagram

### 3. USER_GUIDE.md
- ‡πÄ‡∏û‡∏¥‡πà‡∏° "Scrap Replacement Configuration"
- UI screenshots
- Best practices

---

## üéØ Recommendations

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production:

1. **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢ Phase 1 (Manual Mode)**
   - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
   - Supervisor ‡∏°‡∏µ control ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà
   - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏• auto spawn bugs

2. **‡πÄ‡∏û‡∏¥‡πà‡∏° Phase 2 ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)**
   - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô pattern ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
   - ‡πÄ‡∏°‡∏∑‡πà‡∏≠ supervisor ‡∏Ç‡∏≠ auto spawn
   - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ logic ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

3. **Default Policy:**
   ```json
   {
     "on_scrap": {
       "mode": "manual",
       "notification": {
         "roles": ["supervisor"]
       }
     }
   }
   ```

---

## ‚ùì Open Questions

1. **Should replacement tokens have different serial numbers?**
   - Option A: `TOTE-001-05-REPLACE`
   - Option B: `TOTE-001-06` (next sequential)
   - Option C: `TOTE-001-05-V2`

2. **Should replacement tokens count toward job ticket qty?**
   - Yes: Job ticket qty = original + replacements
   - No: Job ticket qty = original only (replacements are extra)

3. **Should we track material cost for replacements?**
   - Yes: Track material loss
   - No: Just track token count

4. **Approval flow: Who can approve?**
   - Supervisor only?
   - Manager only?
   - Both?

---

## üìä Summary

### Key Points:

‚úÖ **‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á policy ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö rework** (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)  
‚úÖ **Phase 1 (Manual) = ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ + ‡∏á‡πà‡∏≤‡∏¢** (2-3 hours)  
‚úÖ **Phase 2 (Auto) = ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢** (4-6 hours)  
‚úÖ **Default = Manual mode** (supervisor control)  
‚úÖ **Flexible = ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢ scenarios**

### Next Steps:

1. Review proposal
2. Decide on Phase 1 vs Phase 2
3. Answer open questions
4. Update documentation
5. Implement (if approved)

---

**Status:** Ready for Review  
**Feedback Welcome:** Please review and provide feedback before implementation

