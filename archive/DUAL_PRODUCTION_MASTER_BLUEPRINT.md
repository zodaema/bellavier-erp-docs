# ðŸ§­ BELLAVIER DUAL PRODUCTION SYSTEM â€” COMPLETE CONCEPT DOCUMENT

**Version:** Advanced Draft 1.0 (Full Logic)  
**Created:** November 5, 2025  
**Authoring Context:** Bellavier ERP Atelier & OEM Unified Flow  
**Purpose:** à¸£à¸§à¸¡à¹à¸™à¸§à¸„à¸´à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸‚à¸­à¸‡à¸£à¸°à¸šà¸š Dual Production, Work Queue, Token Flow, DAG, Assignment à¹à¸¥à¸° Routing Graph Designer à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸ à¸²à¸žà¹€à¸”à¸µà¸¢à¸§à¸—à¸µà¹ˆà¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡ à¸ªà¸¡à¸ˆà¸£à¸´à¸‡ à¹à¸¥à¸°à¸›à¸£à¸±à¸šà¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¹ƒà¸™à¸£à¸°à¸šà¸šà¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¹‚à¸£à¸‡à¸‡à¸²à¸™

---

## 1. à¸«à¸¥à¸±à¸à¸„à¸´à¸”à¸£à¸°à¸”à¸±à¸šà¸ à¸²à¸žà¸£à¸§à¸¡ (Core Philosophy)

à¸£à¸°à¸šà¸šà¸™à¸µà¹‰à¸¡à¸µà¸ˆà¸¸à¸”à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œà¹€à¸žà¸·à¹ˆà¸­à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¹€à¸”à¸´à¸¡à¸‚à¸­à¸‡à¸à¸²à¸£à¸œà¸¥à¸´à¸• 2 à¸£à¸°à¸šà¸šà¸—à¸µà¹ˆ "à¸‚à¸±à¸”à¹à¸¢à¹‰à¸‡à¸à¸±à¸™à¹€à¸­à¸‡"

à¸„à¸·à¸­ **Atelier** (à¸‡à¸²à¸™à¸à¸µà¸¡à¸·à¸­à¸Šà¸´à¹‰à¸™à¸•à¹ˆà¸­à¸Šà¸´à¹‰à¸™) à¹à¸¥à¸° **OEM/Batch** (à¸‡à¸²à¸™à¸ˆà¸³à¸™à¸§à¸™à¸¡à¸²à¸à¹à¸šà¸šà¹„à¸¥à¸™à¹Œ)

à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸„à¸·à¸­à¸—à¸³à¹ƒà¸«à¹‰à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸£à¸°à¸šà¸š ERP à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¹„à¸”à¹‰

à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ 3 à¸Šà¸±à¹‰à¸™à¸«à¸¥à¸±à¸:

1. **Production Type Everywhere** â€“ à¹à¸¢à¸à¸ªà¸²à¸¢à¸‡à¸²à¸™à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¸•à¹‰à¸™à¸—à¸²à¸‡ (Product/MO/Job)
2. **Routing Graph System** â€“ à¹ƒà¸«à¹‰ flow à¸‚à¸­à¸‡à¸‡à¸²à¸™à¸à¸³à¸«à¸™à¸”à¹‚à¸”à¸¢ Graph à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ "node" à¹à¸¥à¸° "edge"
3. **Work Queue with Token Lifecycle** â€“ à¹ƒà¸«à¹‰à¸„à¸™à¸—à¸³à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸šà¸œà¹ˆà¸²à¸™à¸«à¸™à¹‰à¸²à¸„à¸´à¸§à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§

---

## 2. à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹à¸¥à¸°à¹à¸™à¸§à¸—à¸²à¸‡ "Dual Production Type"

| à¸à¸±à¹ˆà¸‡ | à¸¥à¸±à¸à¸©à¸“à¸° | à¸žà¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¸£à¸°à¸šà¸š |
|------|--------|--------------|
| **Atelier** | à¸‡à¸²à¸™à¸à¸µà¸¡à¸·à¸­ à¸Šà¸´à¹‰à¸™à¸•à¹ˆà¸­à¸Šà¸´à¹‰à¸™ à¹€à¸™à¹‰à¸™à¸„à¸¸à¸“à¸ à¸²à¸ž | à¹‚à¸—à¹€à¸„à¸™à¹€à¸à¸´à¸”à¸ˆà¸²à¸à¸à¸²à¸£ "à¸ªà¸£à¹‰à¸²à¸‡ Job à¹‚à¸”à¸¢à¸•à¸£à¸‡" (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µ MO) / batch_size=1 / flow à¸¢à¸·à¸”à¸«à¸¢à¸¸à¹ˆà¸™ / QC à¹€à¸‰à¸žà¸²à¸°à¸ˆà¸¸à¸”à¸ªà¸³à¸„à¸±à¸ |
| **OEM (Batch)** | à¸‡à¸²à¸™à¸ˆà¸³à¸™à¸§à¸™à¸¡à¸²à¸ à¹€à¸™à¹‰à¸™ throughput | à¹‚à¸—à¹€à¸„à¸™à¹€à¸à¸´à¸”à¸ˆà¸²à¸ MO / batch_size>1 / flow à¹à¸‚à¹‡à¸‡à¹à¸£à¸‡ / require due_date & quantity / QC sampling |

à¸—à¸¸à¸à¸ˆà¸¸à¸”à¹ƒà¸™à¸£à¸°à¸šà¸šà¸ˆà¸°à¸¡à¸µà¸Ÿà¸´à¸¥à¸”à¹Œ `production_type` (atelier/oem/hybrid)

à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆ **Product â†’ Pattern â†’ RoutingSet â†’ DAG Template â†’ MO â†’ Job â†’ Token â†’ Work Queue**

---

## 3. Routing Graph System (DAG Architecture)

### 3.1 à¹à¸™à¸§à¸„à¸´à¸”

Routing Graph à¸„à¸·à¸­ **"à¸ªà¸¡à¸­à¸‡à¸‚à¸­à¸‡à¸ªà¸²à¸¢à¸à¸²à¸£à¸œà¸¥à¸´à¸•"**

à¹à¸—à¸™à¸—à¸µà¹ˆà¸ˆà¸°à¸šà¸±à¸‡à¸„à¸±à¸š Linear Flow, à¸£à¸°à¸šà¸šà¸™à¸µà¹‰à¹ƒà¸Šà¹‰ **Directed Acyclic Graph (DAG)**

à¸‹à¸¶à¹ˆà¸‡ node à¹à¸•à¹ˆà¸¥à¸°à¸•à¸±à¸§à¹à¸—à¸™ "à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™" à¹à¸¥à¸° edge à¹à¸—à¸™ "à¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¸²à¸£à¹„à¸«à¸¥à¸‚à¸­à¸‡à¸Šà¸´à¹‰à¸™à¸‡à¸²à¸™"

### 3.2 à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¸­à¸‡ Node

| node_type | à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|-----------|---------|----------|
| **start** | à¸ˆà¸¸à¸”à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸‚à¸­à¸‡à¸à¸²à¸£à¸œà¸¥à¸´à¸• | à¸ªà¸£à¹‰à¸²à¸‡ token à¸Šà¸¸à¸”à¹à¸£à¸ |
| **operation** | à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸—à¸±à¹ˆà¸§à¹„à¸› | à¸¡à¸µà¸œà¸¹à¹‰à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸ˆà¸£à¸´à¸‡à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸—à¸³à¸‡à¸²à¸™ |
| **split** | à¹à¸¢à¸ token à¹€à¸›à¹‡à¸™à¸«à¸¥à¸²à¸¢à¹€à¸ªà¹‰à¸™ | à¹€à¸Šà¹ˆà¸™ à¹à¸¢à¸à¸ªà¹ˆà¸§à¸™ Body / Strap |
| **join** | à¸£à¸§à¸¡à¸«à¸¥à¸²à¸¢ token à¹€à¸‚à¹‰à¸²à¸”à¹‰à¸§à¸¢à¸à¸±à¸™ | à¹€à¸Šà¹ˆà¸™ à¸›à¸£à¸°à¸à¸­à¸šà¸•à¸±à¸§à¸à¸£à¸°à¹€à¸›à¹‹à¸² |
| **decision** | à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚ | à¸à¸³à¸«à¸™à¸”à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸•à¸²à¸¡à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ à¹€à¸Šà¹ˆà¸™ QC pass/fail |
| **end** | à¸ˆà¸¸à¸”à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸” | à¸›à¸´à¸”à¸à¸²à¸£à¸œà¸¥à¸´à¸•à¹à¸¥à¸°à¸šà¸±à¸™à¸—à¸¶à¸à¸œà¸¥ |

---

## 4. Token Lifecycle (à¸§à¸‡à¸ˆà¸£à¸Šà¸µà¸§à¸´à¸•à¸‚à¸­à¸‡à¸‡à¸²à¸™)

### 4.1 à¸«à¸¥à¸±à¸à¸à¸²à¸£

- **Token à¹€à¸à¸´à¸”à¹à¸„à¹ˆà¸—à¸µà¹ˆ START** à¸ˆà¸²à¸à¸™à¸±à¹‰à¸™ "à¹„à¸«à¸¥" à¸œà¹ˆà¸²à¸™à¹à¸•à¹ˆà¸¥à¸° node à¸•à¸²à¸¡à¸¥à¸¹à¸à¸¨à¸£ (edge)
- à¹à¸•à¹ˆà¸¥à¸° node à¹„à¸¡à¹ˆà¸ªà¸£à¹‰à¸²à¸‡ token à¹ƒà¸«à¸¡à¹ˆà¹‚à¸”à¸¢à¸•à¸£à¸‡ à¹à¸•à¹ˆà¸ªà¸£à¹‰à¸²à¸‡ **"work_item"** (à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³)
- Token à¸ˆà¸°à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°à¹€à¸¡à¸·à¹ˆà¸­ node à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ

### 4.2 à¸ªà¸–à¸²à¸™à¸°à¸‚à¸­à¸‡ Token

```
waiting â†’ active â†’ done â†’ scrapped/replaced
```

### 4.3 à¸à¸£à¸“à¸µ Cancel / QC Fail

- à¸–à¹‰à¸² Cancel à¹€à¸žà¸£à¸²à¸° **QC Fail** â†’ à¸£à¸°à¸šà¸šà¸ªà¸£à¹‰à¸²à¸‡ **Replacement Token** à¸—à¸µà¹ˆ node à¹€à¸”à¸´à¸¡ (à¹à¸—à¸™à¸—à¸µà¹ˆà¸Šà¸´à¹‰à¸™à¸™à¸±à¹‰à¸™)
- à¸–à¹‰à¸² Cancel à¹€à¸žà¸£à¸²à¸° **Redesign** â†’ à¸£à¸°à¸šà¸š mark à¹„à¸§à¹‰à¹ƒà¸«à¹‰à¸«à¸±à¸§à¸«à¸™à¹‰à¸²à¸ªà¸²à¸¢à¸‡à¸²à¸™à¸—à¸³à¸à¸²à¸£à¹à¸à¹‰ routing à¸«à¸£à¸·à¸­à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸šà¸•à¹‰à¸™à¸—à¸²à¸‡
- à¸–à¹‰à¸² Cancel à¹à¸šà¸šà¸–à¸²à¸§à¸£ â†’ Status = `scrapped` (à¹„à¸¡à¹ˆà¹€à¸”à¸´à¸™à¸•à¹ˆà¸­)

---

## 5. Work Item System (à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™à¸•à¹ˆà¸­ Node)

à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆ Token "à¹€à¸‚à¹‰à¸²" node à¸Šà¸™à¸´à¸” `operation` â†’ à¸ªà¸£à¹‰à¸²à¸‡ **work_item**

| à¸Ÿà¸´à¸¥à¸”à¹Œà¸«à¸¥à¸±à¸ | à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢ |
|-----------|----------|
| id_token | Token à¸•à¹‰à¸™à¸—à¸²à¸‡ |
| id_node | Node à¸—à¸µà¹ˆà¸‡à¸²à¸™à¸­à¸¢à¸¹à¹ˆ |
| id_work_center | à¸¨à¸¹à¸™à¸¢à¹Œà¸‡à¸²à¸™ |
| status | waiting / assigned / claimed / in_progress / paused / done |
| assigned_to | à¸„à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸¡à¸­à¸šà¸«à¸¡à¸²à¸¢ |
| operators_required | à¸ˆà¸³à¸™à¸§à¸™à¸„à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™ |
| batch_size | à¸ˆà¸³à¸™à¸§à¸™à¸Šà¸´à¹‰à¸™à¹ƒà¸™à¸‡à¸²à¸™ |
| claimed_count | à¸ˆà¸³à¸™à¸§à¸™à¸„à¸™à¸—à¸µà¹ˆà¸à¸” Claim à¹à¸¥à¹‰à¸§ |
| complete_count | à¸ˆà¸³à¸™à¸§à¸™à¸„à¸™à¸—à¸µà¹ˆ Complete à¹à¸¥à¹‰à¸§ |

---

## 6. Work Queue (à¸£à¸°à¸šà¸šà¸Šà¹ˆà¸²à¸‡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡)

### 6.1 à¸«à¸™à¹‰à¸²à¸ˆà¸­à¸‚à¸­à¸‡à¸Šà¹ˆà¸²à¸‡ (Operator)

à¸Šà¹ˆà¸²à¸‡à¸ˆà¸°à¹€à¸«à¹‡à¸™à¸£à¸²à¸¢à¸à¸²à¸£à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡ (work_item)

à¸ªà¸²à¸¡à¸²à¸£à¸–:
- **Claim** à¸£à¸±à¸šà¸‡à¸²à¸™
- **Start** à¹€à¸žà¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³ (à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸§à¸¥à¸²)
- **Pause / Resume** (à¸žà¸£à¹‰à¸­à¸¡à¹€à¸«à¸•à¸¸à¸œà¸¥)
- **Complete** à¸ªà¹ˆà¸‡à¸‡à¸²à¸™à¸•à¹ˆà¸­
- **Handoff / Requeue** à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸—à¸³à¸•à¹ˆà¸­à¹„à¸”à¹‰

### 6.2 à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£

| à¸ªà¸–à¸²à¸™à¸° | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|-------|----------|
| **Assigned** | à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸¡à¸­à¸šà¸«à¸¡à¸²à¸¢à¹„à¸§à¹‰ à¹à¸•à¹ˆà¸Šà¹ˆà¸²à¸‡à¸¢à¸±à¸‡à¹„à¸¡à¹ˆ Claim |
| **Claimed** | à¸Šà¹ˆà¸²à¸‡à¸£à¸±à¸šà¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡à¹à¸¥à¹‰à¸§ |
| **In Progress** | à¸‡à¸²à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³ (Start) |
| **Paused** | à¸«à¸¢à¸¸à¸”à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ |
| **Done** | à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­ node à¸–à¸±à¸”à¹„à¸› |
| **Handoff / Requeue** | à¹‚à¸¢à¸™à¸‡à¸²à¸™à¸à¸¥à¸±à¸šà¸„à¸´à¸§à¸à¸¥à¸²à¸‡ / à¹ƒà¸«à¹‰à¸„à¸™à¸­à¸·à¹ˆà¸™ |
| **Auto-Reassign** | à¸£à¸°à¸šà¸šà¸¢à¹‰à¸²à¸¢à¹ƒà¸«à¹‰à¹€à¸­à¸‡à¹€à¸¡à¸·à¹ˆà¸­ timeout à¸«à¸£à¸·à¸­à¸Šà¹ˆà¸²à¸‡à¹„à¸¡à¹ˆà¸­à¸¢à¸¹à¹ˆ |

---

## 7. Assignment & Auto-Reassign Logic

### 7.1 à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸à¸•à¸´à¸à¸² (Assignment Rule)

à¸£à¸°à¸”à¸±à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™:
```
instance â†’ template â†’ work_center â†’ global
```

à¸à¸•à¸´à¸à¸²à¹à¸•à¹ˆà¸¥à¸°à¸‚à¹‰à¸­à¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸³à¸«à¸™à¸”:
- **pool** à¸‚à¸­à¸‡à¸„à¸™à¸—à¸µà¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œà¸£à¸±à¸šà¸‡à¸²à¸™
- **max WIP** à¸•à¹ˆà¸­à¸„à¸™
- **on_absent** (substitute / requeue / manager_approve)
- **skill tags**
- **fallback pool**

### 7.2 à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ Assign

1. à¹€à¸¡à¸·à¹ˆà¸­ work_item à¸–à¸¹à¸à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¸¶à¹‰à¸™à¸ˆà¸²à¸ Token
2. à¸£à¸°à¸šà¸šà¹€à¸£à¸µà¸¢à¸ **AssignmentEngine** à¹€à¸žà¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸à¸„à¸™à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡
3. à¸–à¹‰à¸²à¸«à¸²à¸„à¸™à¹„à¸¡à¹ˆà¹„à¸”à¹‰ â†’ à¸ªà¸–à¸²à¸™à¸° = `waiting`
4. à¸Šà¹ˆà¸²à¸‡à¸ªà¸²à¸¡à¸²à¸£à¸– "Claim" à¸ˆà¸²à¸à¸„à¸´à¸§à¸à¸¥à¸²à¸‡à¸‚à¸­à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸‡à¸²à¸™

### 7.3 Handling à¸Šà¹ˆà¸²à¸‡à¸¥à¸²à¸«à¸¢à¸¸à¸”

1. à¸Šà¹ˆà¸²à¸‡à¸•à¸±à¹‰à¸‡à¸ªà¸–à¸²à¸™à¸° `on_leave` (à¸«à¸£à¸·à¸­à¸«à¸±à¸§à¸«à¸™à¹‰à¸²à¸•à¸±à¹‰à¸‡à¹ƒà¸«à¹‰)
2. **Sweeper** à¸•à¸£à¸§à¸ˆà¹€à¸ˆà¸­ â†’ à¸¢à¹‰à¸²à¸¢à¸‡à¸²à¸™à¸•à¸²à¸¡ rule:
   - **substitute** â†’ à¸„à¸™à¸ªà¸³à¸£à¸­à¸‡à¹ƒà¸™ pool
   - **requeue** â†’ à¸„à¸·à¸™à¸„à¸´à¸§à¸à¸¥à¸²à¸‡
   - **manager_approve** â†’ à¹€à¸‚à¹‰à¸²à¸à¸¥à¹ˆà¸­à¸‡ inbox à¹ƒà¸«à¹‰à¸«à¸±à¸§à¸«à¸™à¹‰à¸²à¸à¸”à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´

---

## 8. Multi-Operator Node (à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™)

à¹ƒà¸Šà¹‰à¸Ÿà¸´à¸¥à¸”à¹Œ:

```json
{
  "operators_required": 2,
  "parallel_allowed": true,
  "sync_start": false,
  "sync_window_sec": 0
}
```

- **operators_required** = à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸à¸µà¹ˆà¸„à¸™à¹ƒà¸™ node à¸™à¸±à¹‰à¸™
- **parallel_allowed** = à¸–à¹‰à¸²à¸—à¸³à¹à¸¢à¸à¸à¸±à¸™à¹„à¸”à¹‰ (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸à¸”à¸žà¸£à¹‰à¸­à¸¡)
- **sync_start** = à¸•à¹‰à¸­à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸™ (à¹ƒà¸Šà¹‰à¸à¸±à¸šà¸‡à¸²à¸™à¸›à¸£à¸°à¸à¸š/à¸ˆà¸±à¸šà¸Šà¸´à¹‰à¸™à¹ƒà¸«à¸à¹ˆ)
- **sync_window_sec** = à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸–à¸·à¸­à¸§à¹ˆà¸²à¹€à¸£à¸´à¹ˆà¸¡à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸™

à¸£à¸°à¸šà¸šà¸ˆà¸°à¸ªà¸£à¹‰à¸²à¸‡ **session** à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸•à¹ˆà¸¥à¸°à¸„à¸™à¹ƒà¸™ node à¸™à¸±à¹‰à¸™

node à¸ˆà¸°à¸–à¸·à¸­à¸§à¹ˆà¸² "à¹€à¸ªà¸£à¹‡à¸ˆ" à¹€à¸¡à¸·à¹ˆà¸­à¸„à¸£à¸šà¸—à¸¸à¸ session à¸—à¸µà¹ˆ required

---

## 9. Manager Workflow

### 9.1 à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸«à¸¥à¸±à¸

- à¸¡à¸­à¸šà¸«à¸¡à¸²à¸¢à¸‡à¸²à¸™ (Assign)
- à¸”à¸¹à¸„à¸´à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ Handoff / Pause / à¸›à¸±à¸à¸«à¸²
- Reassign à¸‡à¸²à¸™
- à¸•à¸±à¹‰à¸‡à¸à¸•à¸´à¸à¸² (Assignment Rule)
- à¸”à¸¹ KPI à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸° node / à¸„à¸™

### 9.2 Manager Dashboard

- à¹à¸ªà¸”à¸‡à¸ à¸²à¸žà¸£à¸§à¸¡ Routing Graph à¸žà¸£à¹‰à¸­à¸¡à¸„à¹ˆà¸²à¸ªà¸–à¸²à¸™à¸°à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸° node
- à¸•à¸±à¸§à¸Šà¸µà¹‰à¸§à¸±à¸”:
  - à¸ˆà¸³à¸™à¸§à¸™à¸‡à¸²à¸™à¸•à¹ˆà¸­ node
  - à¹€à¸§à¸¥à¸²à¸£à¸­à¹€à¸‰à¸¥à¸µà¹ˆà¸¢ (waiting time)
  - Utilization per operator
  - à¸‡à¸²à¸™à¸„à¹‰à¸²à¸‡à¹€à¸à¸´à¸™ SLA
  - à¸„à¸™à¸¥à¸²à¸›à¹ˆà¸§à¸¢/offline

### 9.3 Manager Inbox

- à¸£à¸§à¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ à¹€à¸Šà¹ˆà¸™
  - à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸–à¸¹à¸ Handoff
  - à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸«à¸¢à¸¸à¸”à¸™à¸²à¸™
  - à¸‡à¸²à¸™à¸—à¸µà¹ˆ reassign à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´

---

## 10. Routing Graph Designer (à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¸­à¸­à¸à¹à¸šà¸š Flow)

### 10.1 à¸«à¸¥à¸±à¸à¸„à¸´à¸”

Designer à¹ƒà¸Šà¹‰à¸„à¸£à¸±à¹‰à¸‡à¹€à¸”à¸µà¸¢à¸§à¸•à¸­à¸™à¸ªà¸£à¹‰à¸²à¸‡ Pattern (1 RoutingSet = à¸«à¸¥à¸²à¸¢ Template per type)

à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸ Publish à¹à¸¥à¹‰à¸§à¸ˆà¸°à¹„à¸¡à¹ˆà¸¢à¹‰à¸­à¸™à¸¡à¸²à¹à¸à¹‰à¸šà¹ˆà¸­à¸¢

### 10.2 à¸Šà¸¸à¸”à¸•à¸±à¸§à¹à¸›à¸£à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µà¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸° Node (Node Params)

| à¸à¸¥à¸¸à¹ˆà¸¡ | à¸•à¸±à¸§à¹à¸›à¸£ | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ | à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ |
|-------|--------|----------|----------|
| **à¸žà¸·à¹‰à¸™à¸à¸²à¸™** | node_type | à¸›à¸£à¸°à¹€à¸ à¸— node | operation |
| | work_center_id | à¸¨à¸¹à¸™à¸¢à¹Œà¸‡à¸²à¸™à¸«à¸¥à¸±à¸ | 3 |
| | operators_required | à¸ˆà¸³à¸™à¸§à¸™à¸„à¸™ | 1 |
| | batch_size | à¸ˆà¸³à¸™à¸§à¸™à¸Šà¸´à¹‰à¸™à¸•à¹ˆà¸­ batch | 1 |
| | requires_serial | à¸•à¹‰à¸­à¸‡à¸¡à¸µ serial à¸à¹ˆà¸­à¸™à¹€à¸‚à¹‰à¸²à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ | false |
| | estimated_minutes | à¹€à¸§à¸¥à¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢à¸•à¹ˆà¸­à¸Šà¸´à¹‰à¸™ | 30 |
| | qc_policy | à¸™à¹‚à¸¢à¸šà¸²à¸¢ QC | { "required": false } |
| | assignment_mode | push/pull/hybrid | push |
| **à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡** | skill_tags | à¸—à¸±à¸à¸©à¸°à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µ | ["cut","sew"] |
| | parallel_allowed | à¸—à¸³à¹à¸¢à¸à¸à¸±à¸™à¹„à¸”à¹‰à¹„à¸«à¸¡ | true |
| | sync_start / sync_window_sec | à¸•à¹‰à¸­à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸™à¹„à¸«à¸¡ | false / 15 |
| | on_absent | à¸–à¹‰à¸²à¸„à¸™à¹„à¸¡à¹ˆà¸­à¸¢à¸¹à¹ˆà¹ƒà¸«à¹‰à¸—à¸³à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£ | substitute |
| | reassign_after_sec | Timeout à¸à¹ˆà¸­à¸™ reassign | 900 |
| | sla_minutes | à¸à¸³à¸«à¸™à¸” SLA à¸•à¹ˆà¸­ node | 60 |
| **à¸žà¸´à¹€à¸¨à¸©** | tokenization_mode | à¸à¸²à¸£à¸™à¸±à¸š token | per_piece |
| | yield_expectation | à¸„à¸²à¸”à¸à¸²à¸£à¸“à¹Œà¸ªà¸¹à¸à¹€à¸ªà¸µà¸¢ (%) | 0 |
| | safety_notes | à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡ | "à¸£à¸°à¸§à¸±à¸‡à¸‚à¸­à¸šà¸„à¸¡" |

Designer à¸„à¸§à¸£à¸¡à¸µ **Preset** à¸•à¹ˆà¸­ Node Type à¹à¸¥à¸° Production Type à¹€à¸žà¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸•à¸±à¹‰à¸‡à¹€à¸­à¸‡à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡

---

## 11. Preset à¸—à¸µà¹ˆà¹à¸™à¸°à¸™à¸³ (Design Once, Use Forever)

| Node Type | Preset (Atelier) | Preset (OEM) |
|-----------|------------------|--------------|
| **Start** | batch_size=1, serial=true | batch_size=N, serial=true |
| **Operation: Cut** | op_required=1 | batch_size=50 |
| **Operation: Sew** | op_required=1 | op_required=2 (à¸„à¸¹à¹ˆà¸Šà¹ˆà¸§à¸¢) |
| **Operation: Edge Paint** | op_required=1 | batch_size=10 |
| **Operation: Assembly** | op_required=2, sync_start=true | op_required=2 |
| **QC** | qc.required=true | qc.sampling_pct=10 |
| **End/Pack** | serial=true, qc.required=true | serial=true, batch_size=10 |

---

## 12. Flow à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™ (à¸ à¸²à¸žà¸£à¸§à¸¡à¸ˆà¸£à¸´à¸‡)

### ðŸ”¸ à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¸Šà¹ˆà¸²à¸‡ (Operator)

1. à¹€à¸›à¸´à¸”à¸«à¸™à¹‰à¸² **Work Queue** â†’ à¹€à¸«à¹‡à¸™à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡
2. à¸à¸” **Claim** â†’ **Start** â†’ à¸—à¸³à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡
3. à¸à¸” **Pause** / **Complete** à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸à¸²à¸£à¸“à¹Œ
4. à¸«à¸²à¸à¹„à¸¡à¹ˆà¸—à¸³à¸•à¹ˆà¸­ â†’ **Handoff** à¸«à¸£à¸·à¸­ **Requeue**
5. à¹€à¸¡à¸·à¹ˆà¸­ complete â†’ token à¹€à¸”à¸´à¸™à¸•à¹ˆà¸­ node à¸–à¸±à¸”à¹„à¸›
6. à¹€à¸«à¹‡à¸™à¸œà¸¥à¸‡à¸²à¸™à¸ªà¸°à¸ªà¸¡, à¹€à¸§à¸¥à¸²à¸—à¸³, KPI à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§

### ðŸ”¸ à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¸«à¸±à¸§à¸«à¸™à¹‰à¸² (Manager)

1. à¹€à¸«à¹‡à¸™ **Routing Graph** à¸—à¸±à¹‰à¸‡à¸£à¸°à¸šà¸š
2. **Assign** à¸‡à¸²à¸™à¸«à¸£à¸·à¸­à¸›à¸¥à¹ˆà¸­à¸¢ **Auto-Assign**
3. à¸•à¸£à¸§à¸ˆà¸„à¸´à¸§à¸‚à¸­à¸‡à¸Šà¹ˆà¸²à¸‡à¹à¸šà¸šà¹€à¸£à¸µà¸¢à¸¥à¹„à¸—à¸¡à¹Œ
4. à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ pause/handoff/reassign
5. à¹à¸à¹‰à¸„à¸­à¸‚à¸§à¸”à¸”à¹‰à¸§à¸¢à¸à¸²à¸£à¹‚à¸¢à¸à¸‡à¸²à¸™
6. à¸”à¸¹ **Efficiency** à¹à¸¥à¸° **SLA** à¹€à¸žà¸·à¹ˆà¸­à¸›à¸£à¸±à¸šà¹à¸œà¸™à¸à¸²à¸£à¸œà¸¥à¸´à¸•

---

## 13. à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡à¸‚à¸­à¸‡à¸£à¸°à¸šà¸šà¸™à¸µà¹‰

| à¸«à¸¡à¸§à¸” | à¸ˆà¸¸à¸”à¹€à¸”à¹ˆà¸™ |
|------|---------|
| **à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥** | à¹à¸¢à¸ production_type à¸Šà¸±à¸”à¹€à¸ˆà¸™ à¹ƒà¸Šà¹‰ graph à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡ Atelier & OEM |
| **à¸›à¸£à¸°à¸ªà¸šà¸à¸²à¸£à¸“à¹Œà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰** | à¸Šà¹ˆà¸²à¸‡à¹€à¸«à¹‡à¸™à¹€à¸‰à¸žà¸²à¸°à¸‡à¸²à¸™à¸•à¸±à¸§à¹€à¸­à¸‡ / à¸«à¸±à¸§à¸«à¸™à¹‰à¸²à¹€à¸«à¹‡à¸™à¸ à¸²à¸žà¸£à¸§à¸¡ / à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸£à¸·à¹‰à¸­à¸à¸£à¸²à¸Ÿ |
| **à¸„à¸§à¸²à¸¡à¸¢à¸·à¸”à¸«à¸¢à¸¸à¹ˆà¸™** | token flow à¹„à¸¡à¹ˆà¸‚à¸²à¸”, à¸¡à¸µ replacement, à¸¡à¸µ requeue, à¹à¸à¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰à¸ˆà¸£à¸´à¸‡ |
| **à¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸ž** | auto-assign / auto-reassign à¸¥à¸” manual work |
| **à¸„à¸§à¸²à¸¡à¹€à¸ªà¸–à¸µà¸¢à¸£** | à¸‡à¸²à¸™à¹€à¸à¹ˆà¸²à¸¢à¸±à¸‡à¸„à¸‡à¸­à¸¢à¸¹à¹ˆà¹„à¸”à¹‰, à¸à¸£à¸²à¸Ÿ freeze per version |
| **à¸‚à¸¢à¸²à¸¢à¸­à¸™à¸²à¸„à¸•** | à¸£à¸­à¸‡à¸£à¸±à¸š Hybrid Product, Skill Match, AI Scheduling à¹„à¸”à¹‰à¹‚à¸”à¸¢à¸•à¸£à¸‡ |

---

## 14. à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡ / Pitfalls

1. âŒ **à¸­à¸¢à¹ˆà¸²à¸›à¸¥à¹ˆà¸­à¸¢à¹ƒà¸«à¹‰à¸—à¸¸à¸ node spawn token à¹€à¸­à¸‡** â€” token à¹€à¸”à¸µà¸¢à¸§à¸•à¹‰à¸­à¸‡à¹€à¸”à¸´à¸™à¸—à¸±à¹‰à¸‡ flow
2. âŒ **à¸«à¹‰à¸²à¸¡à¸œà¸¹à¸ operator à¸–à¸²à¸§à¸£à¸à¸±à¸š token** â€” à¸•à¹‰à¸­à¸‡à¸œà¸¹à¸à¸à¸±à¸š work_item
3. âŒ **à¸­à¸¢à¹ˆà¸²à¹ƒà¸«à¹‰ designer à¸•à¹‰à¸­à¸‡à¸•à¸±à¹‰à¸‡ param à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡** â€” à¹ƒà¸Šà¹‰ preset/publish model
4. âŒ **à¸­à¸¢à¹ˆà¸²à¸›à¸¥à¹ˆà¸­à¸¢à¹ƒà¸«à¹‰ cancel à¹à¸¥à¹‰à¸§à¸•à¸±à¸” flow** â€” à¸•à¹‰à¸­à¸‡à¸¡à¸µ replacement à¸«à¸£à¸·à¸­ redesign queue
5. âŒ **à¸­à¸¢à¹ˆà¸² merge Atelier à¸à¸±à¸š OEM à¹ƒà¸™ flow à¹€à¸”à¸µà¸¢à¸§** â€” à¸•à¹‰à¸­à¸‡à¹à¸¢à¸ routing_template à¸•à¸²à¸¡ type

---

## 15. à¹à¸™à¸§à¸—à¸²à¸‡à¸à¸²à¸£ Implement

### DB Changes:
- à¹€à¸žà¸´à¹ˆà¸¡ `production_type`, `work_item`, `assignment_rule`, `operator_session`

### Services:
- **GraphRuntimeService** (token flow)
- **AssignmentEngine** (à¹€à¸¥à¸·à¸­à¸à¸„à¸™)
- **TokenLifecycleService** (cancel, replace, redesign)
- **WorkQueueService** (UI à¸Šà¹ˆà¸²à¸‡)
- **ManagerDashboardService**

### UI:
- **Operator Work Queue**
- **Manager Assignment + Live Queue + Inbox**
- **Routing Graph Designer** (à¹ƒà¸Šà¹‰ preset + publish)

### Deployment Strategy:
1. Pilot à¸à¸±à¸š **Atelier** à¸à¹ˆà¸­à¸™ (batch_size=1)
2. à¸—à¸”à¸ªà¸­à¸š requeue, replacement, QC fail
3. à¸•à¹ˆà¸­à¸à¸±à¸š **OEM** à¸«à¸¥à¸±à¸‡à¸£à¸°à¸šà¸šà¹€à¸ªà¸–à¸µà¸¢à¸£

---

## 16. à¸ªà¸£à¸¸à¸›à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢

à¸£à¸°à¸šà¸šà¸™à¸µà¹‰à¸­à¸­à¸à¹à¸šà¸šà¸¡à¸²à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ **"à¸‡à¸²à¸™à¸—à¸¸à¸à¸Šà¸´à¹‰à¸™à¹ƒà¸™ Bellavier à¹€à¸”à¸´à¸™à¹„à¸”à¹‰à¹€à¸­à¸‡à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸‚à¸²à¸”à¸•à¸­à¸™"**

à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸à¸£à¸°à¹€à¸›à¹‹à¸²à¸Šà¸´à¹‰à¸™à¹€à¸”à¸µà¸¢à¸§ à¸«à¸£à¸·à¸­à¸œà¸¥à¸´à¸• 300 à¸Šà¸´à¹‰à¸™à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸™

à¸¡à¸±à¸™à¹„à¸¡à¹ˆà¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™à¸à¸§à¹ˆà¸²à¸£à¸°à¸šà¸šà¹€à¸”à¸´à¸¡ à¹à¸•à¹ˆ **"à¸„à¸´à¸”à¸„à¸£à¸šà¸§à¸‡à¸ˆà¸£"** â€”

à¸ˆà¸²à¸ **Designer â†’ Manager â†’ Operator â†’ Token â†’ Graph â†’ Queue â†’ Report â†’ Audit**

à¸—à¸¸à¸à¸ªà¸´à¹ˆà¸‡à¸œà¸¹à¸à¸”à¹‰à¸§à¸¢à¸«à¸¥à¸±à¸à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™:

> **"Flow à¹„à¸¡à¹ˆà¸‚à¸²à¸”, à¸‡à¸²à¸™à¹„à¸¡à¹ˆà¸«à¸²à¸¢, à¸„à¸™à¹„à¸¡à¹ˆà¸«à¸¥à¸‡"**

---

**Status:** Master Blueprint Approved  
**Next:** Implementation Roadmap

